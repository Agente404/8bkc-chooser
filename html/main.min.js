var $ub,xhr=j();function setProgress(e){$("#progressbarinner").style.width=String(e*$("#progressbar").clientWidth)+"px"}function doUpgrade(){var e=$("#file").files[0],r=$("#remark");if(r.style.display="none",void 0===e)return r.style.display="block",void(r.innerHTML="Can't read file!");var t=$("#file").value;return t=t.replace(/^.*[\\\/]/,""),xhr.open("POST","upload.cgi?name="+t),xhr.onreadystatechange=function(){4==xhr.readyState&&(200<=xhr.status&&xhr.status<300||400==xhr.status)&&(setProgress(1),""!=xhr.responseText?(alert("Error: "+xhr.responseText),$ub.value="Error!"):triggerReload())},void 0!==xhr.upload.onprogress&&(xhr.upload.onprogress=function(e){setProgress(e.loaded/e.total),$ub.value="Uploading…"}),xhr.send(e),!1}function triggerReload(){$ub.value="Upload!",xhr.open("GET","fileidx.cgi"),xhr.onreadystatechange=function(){if(4==xhr.readyState&&200<=xhr.status&&xhr.status<300){for(var e=JSON.parse(xhr.responseText),r=$("#fileidx");1!=r.rows.length;)r.deleteRow(1);for(var t=0;t<e.files.length;t++){var s=r.insertRow(-1),a=s.insertCell(-1),n=s.insertCell(-1),i=s.insertCell(-1);a.appendChild(document.createTextNode(e.files[t].name)),1048576<=e.files[t].size?n.appendChild(document.createTextNode(parseInt(e.files[t].size/1048576)+" MiB")):n.appendChild(document.createTextNode(parseInt(e.files[t].size/1024)+" KiB"));var o=document.createElement("a");o.setAttribute("href","delete.cgi?idx="+e.files[t].index),o.appendChild(document.createTextNode("✖")),i.appendChild(o)}setProgress(0)}},xhr.send()}window.onload=function(){$ub=$("#ub"),triggerReload()};